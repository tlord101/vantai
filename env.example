# Environment Variables Template

## Functions Environment (.env in /functions/)

```bash
#############################################
# PAYSTACK PAYMENT INTEGRATION
#############################################

# Secret key for server-side Paystack API calls
# Get from: https://dashboard.paystack.com/#/settings/developer
# Format: sk_test_xxx (test) or sk_live_xxx (production)
PAYSTACK_SECRET_KEY=sk_test_YOUR_SECRET_KEY_HERE

# Webhook secret for verifying Paystack webhook signatures
# Get from: https://dashboard.paystack.com/#/settings/developer
# Format: whsec_xxx
PAYSTACK_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_HERE


#############################################
# GOOGLE GEMINI AI
#############################################

# API key for Gemini Pro Vision model
# Get from: https://makersuite.google.com/app/apikey
# Format: AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX


#############################################
# FIREBASE ADMIN SDK
#############################################

# Auto-injected by Firebase Cloud Functions
# No manual configuration needed for deployed functions
# For local emulation, download service account JSON from Firebase Console
FIREBASE_CONFIG=auto


#############################################
# OPTIONAL: GOOGLE CLOUD VISION API
#############################################

# Uses same credentials as Firebase Admin SDK
# Enable API: gcloud services enable vision.googleapis.com
# No additional keys needed
```

## Client Environment (.env in root/)

```bash
#############################################
# FIREBASE CLIENT SDK
#############################################

# Firebase Web App Configuration
# Get from: Firebase Console > Project Settings > Your apps > Web app config

# API Key (public, safe to expose)
VITE_FIREBASE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Auth Domain
VITE_FIREBASE_AUTH_DOMAIN=yourproject.firebaseapp.com

# Project ID
VITE_FIREBASE_PROJECT_ID=yourproject

# Storage Bucket
VITE_FIREBASE_STORAGE_BUCKET=yourproject.appspot.com

# Messaging Sender ID
VITE_FIREBASE_MESSAGING_SENDER_ID=123456789012

# App ID
VITE_FIREBASE_APP_ID=1:123456789012:web:abcdef123456


#############################################
# PAYSTACK CLIENT
#############################################

# Paystack public key for client-side payment initialization
# Get from: https://dashboard.paystack.com/#/settings/developer
# Format: pk_test_xxx (test) or pk_live_xxx (production)
VITE_PAYSTACK_PUBLIC_KEY=pk_test_YOUR_PUBLIC_KEY_HERE


#############################################
# API ENDPOINTS
#############################################

# Firebase Cloud Functions base URL
# Development: http://127.0.0.1:5001/yourproject/us-central1
# Production: https://us-central1-yourproject.cloudfunctions.net
VITE_FIREBASE_FUNCTIONS_URL=https://us-central1-yourproject.cloudfunctions.net


#############################################
# OPTIONAL: FEATURE FLAGS
#############################################

# Enable development mode features
VITE_DEV_MODE=false

# Enable verbose logging
VITE_ENABLE_LOGGING=false

# Enable analytics
VITE_ENABLE_ANALYTICS=true
```

## Firebase Functions Config (Alternative to .env)

Instead of using `.env` files, you can use Firebase Functions config:

```bash
# Set Paystack keys
firebase functions:config:set \
  paystack.secret_key="sk_test_YOUR_SECRET_KEY" \
  paystack.webhook_secret="whsec_YOUR_WEBHOOK_SECRET"

# Set Gemini API key
firebase functions:config:set \
  gemini.api_key="AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# View current config
firebase functions:config:get

# Download config for local emulation
firebase functions:config:get > .runtimeconfig.json
```

Access in functions code:
```typescript
import * as functions from "firebase-functions";

const paystackKey = functions.config().paystack.secret_key;
const geminiKey = functions.config().gemini.api_key;
```

## Environment-Specific Configurations

### Development (.env.development)

```bash
# Use test keys for development
PAYSTACK_SECRET_KEY=sk_test_xxxxx
VITE_PAYSTACK_PUBLIC_KEY=pk_test_xxxxx

# Local emulator
VITE_FIREBASE_FUNCTIONS_URL=http://127.0.0.1:5001/yourproject/us-central1

# Enable dev features
VITE_DEV_MODE=true
VITE_ENABLE_LOGGING=true
```

### Staging (.env.staging)

```bash
# Staging Paystack keys
PAYSTACK_SECRET_KEY=sk_test_staging_xxxxx
VITE_PAYSTACK_PUBLIC_KEY=pk_test_staging_xxxxx

# Staging Firebase project
VITE_FIREBASE_PROJECT_ID=yourproject-staging
VITE_FIREBASE_FUNCTIONS_URL=https://us-central1-yourproject-staging.cloudfunctions.net

# Test mode features
VITE_DEV_MODE=true
```

### Production (.env.production)

```bash
# LIVE Paystack keys - KEEP SECURE
PAYSTACK_SECRET_KEY=sk_live_xxxxx
VITE_PAYSTACK_PUBLIC_KEY=pk_live_xxxxx

# Production Firebase project
VITE_FIREBASE_PROJECT_ID=yourproject-prod
VITE_FIREBASE_FUNCTIONS_URL=https://us-central1-yourproject-prod.cloudfunctions.net

# Production settings
VITE_DEV_MODE=false
VITE_ENABLE_LOGGING=false
VITE_ENABLE_ANALYTICS=true
```

## Security Notes

### DO NOT:
- ❌ Commit `.env` files to Git (add to `.gitignore`)
- ❌ Expose secret keys client-side (only public keys like `pk_*`)
- ❌ Use production keys in development
- ❌ Share keys via email or Slack
- ❌ Hard-code keys in source files

### DO:
- ✅ Use `.env.example` as template (no real keys)
- ✅ Store production keys in secure password manager
- ✅ Rotate keys quarterly
- ✅ Use environment-specific keys (dev/staging/prod)
- ✅ Set up key expiration alerts
- ✅ Use Firebase Functions config for server-side secrets

## Key Rotation Procedure

### Paystack Keys

1. **Generate new keys:**
   - Go to Paystack Dashboard > Settings > API Keys & Webhooks
   - Click "Regenerate" for secret key
   - Copy new `sk_live_xxxxx` and `pk_live_xxxxx`

2. **Update server:**
   ```bash
   firebase functions:config:set paystack.secret_key="NEW_SECRET_KEY"
   firebase deploy --only functions
   ```

3. **Update client:**
   - Update `VITE_PAYSTACK_PUBLIC_KEY` in `.env`
   - Rebuild and redeploy client

4. **Verify:**
   - Test payment flow end-to-end
   - Monitor webhook delivery

### Gemini API Key

1. **Generate new key:**
   - Go to Google AI Studio > Get API Key
   - Create new key
   - Copy `AIzaSyXXXX...`

2. **Update functions:**
   ```bash
   firebase functions:config:set gemini.api_key="NEW_API_KEY"
   firebase deploy --only functions
   ```

3. **Revoke old key:**
   - Delete old key in Google AI Studio

4. **Verify:**
   - Test image generation endpoint
   - Check Cloud Functions logs

### Firebase Service Account

1. **Generate new service account:**
   - Firebase Console > Project Settings > Service Accounts
   - Click "Generate new private key"
   - Download JSON file

2. **Update deployment:**
   - Replace old service account in CI/CD secrets
   - Update local `serviceAccountKey.json`

3. **Delete old account:**
   - Google Cloud Console > IAM & Admin > Service Accounts
   - Delete old service account

## Troubleshooting

### "Invalid API Key" errors
- ✅ Check key format (no extra spaces/newlines)
- ✅ Verify key is for correct environment (test vs live)
- ✅ Ensure key hasn't been revoked
- ✅ Check Firebase Functions config: `firebase functions:config:get`

### Webhook signature verification fails
- ✅ Verify `PAYSTACK_WEBHOOK_SECRET` matches Paystack dashboard
- ✅ Check webhook URL in Paystack is correct
- ✅ Review Cloud Functions logs for actual vs expected signature

### Environment variables not loading
- ✅ Restart dev server after changing `.env`
- ✅ Check `.env` file location (root for client, `/functions` for server)
- ✅ Verify variable names start with `VITE_` for client-side access
- ✅ Run `firebase functions:config:get > .runtimeconfig.json` for local emulation

---

## Quick Setup

1. **Copy this template:**
   ```bash
   cp .env.example .env
   cp functions/.env.example functions/.env
   ```

2. **Fill in your keys:**
   - Get Paystack keys from dashboard
   - Get Firebase config from console
   - Get Gemini key from AI Studio

3. **Verify setup:**
   ```bash
   # Check client can load config
   npm run dev
   
   # Check functions can load config
   cd functions && npm run serve
   ```

4. **Add to .gitignore:**
   ```
   .env
   .env.local
   .env.*.local
   functions/.env
   functions/.runtimeconfig.json
   ```
